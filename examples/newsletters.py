import os
import json

from getresponse.getresponsev3 import Newsletters
from tests.tests import TestNewsletters

API_ENDPOINT = os.getenv('API_ENDPOINT', None)
API_KEY = os.getenv('API_KEY', None)
X_DOMAIN = os.getenv('X_DOMAIN', None)
X_TIME_ZONE = os.getenv('X_TIME_ZONE', None)
HEADERS = os.getenv('HEADERS', None)


def _open_test_data(filename):
    with open(TestNewsletters._get_test_data_path(filename + '.html')) as f:
        return f.read()


getresponse = Newsletters(api_endpoint=API_ENDPOINT, api_key=API_KEY, x_domain=X_DOMAIN)

newsletters = getresponse.get_newsletters(sort='asc')
print('List of all newsletters is: \n {}'.format(newsletters))

newsletter = getresponse.get_newsletter('d')
print('Newsletter with id {} is: \n {}'.format('d', newsletter))
newsletter_stats = getresponse.get_newsletters_statistics(['newsletterId=d'])
print('Newsletter stats of id {} is: \n {}'.format('d', newsletter_stats))

newsletter_campaign = {'campaignId': 'e'}
newsletter_from = {'fromFieldId': '3'}
html = _open_test_data('newsletter')
newsletter_content = Newsletters.prepare_content(html, '')

# newsletter_create = getresponse.post_newsletters('test', 'test auch', newsletter_from, newsletter_campaign,
#                                                  newsletter_content, Newsletters.prepare_send_settings(
#         selected_campaigns=['e']))
# print(newsletter_create)

#
# newsletter_create_response = {'status': 'enabled', 'flags': ['openrate', 'clicktrack'], 'editor': 'custom', 'clickTracks': [], 'newsletterId': 'Y', 'campaign': {'name': 'test_camp', 'campaignId': 'e', 'href': 'https://api3.getresponse360.pl/v3/campaigns/e'}, 'attachments': [], 'sendSettings': {'perfectTiming': 'false', 'excludedSegments': [], 'selectedSegments': [], 'selectedSuppressions': [], 'selectedCampaigns': ['e'], 'excludedCampaigns': [], 'selectedContacts': [], 'selectedSuppresions': [], 'timeTravel': 'false'}, 'href': 'https://api3.getresponse360.pl/v3/newsletters/Y', 'createdOn': '2017-04-06T10:52:45+0000', 'sendOn': '2017-04-06T10:52:45+0000', 'type': 'broadcast', 'name': 'test', 'fromField': {'fromFieldId': '3', 'href': 'https://api3.getresponse360.pl/v3/from-fields/3'}, 'subject': 'test auch', 'replyTo': {'fromFieldId': None, 'href': 'https://api3.getresponse360.pl/v3/from-fields'}, 'sendMetrics': {'total': '0', 'status': 'in_progress', 'sent': '0'}, 'content': {'plain': '', 'html': '<table align="center" width="100%" cellpadding="0" cellspacing="0" border="0" data-mobile="true" dir="ltr" data-width="600" style="font-size: 16px; background-color: rgb(235, 235, 235);">\n    <tbody><tr>\n        <td align="center" valign="top" style="margin:0;padding:0 0 130px;">\n            <table align="center" border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff" width="600" class="wrapper" style="width: 600px;">\n                <tbody><tr>\n                    <td align="center" valign="top" bgcolor="#ebebeb" style="margin:0;padding:0 50px;">\n                        <table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="image" data-mobile-width="0" width="223">\n                            <tbody><tr>\n                                <td valign="top" align="center" style="margin: 0px; padding: 32px 0px 24px; display: inline-block; background-color: rgb(235, 235, 235);" class="tdBlock"><a href=""><img src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_01.png" alt="" width="223" height="23" border="0" data-origsrc="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_01.png" data-src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_01.png|223|23|223|23|0|0|1" style="border: 0px none transparent; display: block;"></a></td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0;padding:0;">\n                        <table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="image" data-mobile-width="1" width="100%" style="max-width: 100% !important;">\n                            <tbody><tr>\n                                <td valign="top" align="center" style="margin: 0px; padding: 0px; display: inline-block;" class="tdBlock"><img src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_02.png" alt="" width="600" border="0" data-origsrc="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_02.png" data-src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_02.png|600|280|600|280|0|0|1" style="border: 0px none transparent; display: block; width: 100%; max-width: 100% !important;"></td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" bgcolor="#00b0ff" style="margin:0; padding:0;background-color:#00b0ff;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-0" style="margin: 0px; padding: 20px 0px; line-height: 1.05; background-color: rgb(0, 176, 255); font-size: 16px; font-family: \'Times New Roman\', Times, serif;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#ffffff;font-size:44px;">\n                                        <span style="font-size:90px;white-space: nowrap;">Only 15</span><br> apartments left\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td valign="top" align="left" style="padding:0;margin:0;">\n                        <table align="center" width="100%" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td valign="top" align="left" class="lh-2" style="padding: 40px 50px 15px; margin: 0px; line-height: 1.25; font-size: 16px; font-family: \'Times New Roman\', Times, serif;">\n                                    <span style="font-family:Helvetica,Arial,sans-serif;font-size:20px;font-weight:300;color:#000000; line-height:1.2;">\n                                        Nowâ€™s the time to hurry! Some time ago, you signed up to our email list, so we thought you might be interested in hearing the latest news.<br>\n                                        <br>\n                                        <span style="font-weight:400;">As of today, we have only 15 apartments left!</span>\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0; padding:0;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-1" style="margin: 0px; padding: 15px 50px 5px; font-size: 16px; font-family: \'Times New Roman\', Times, serif; line-height: 1.15;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#000000;font-size:30px;">\n                                        See what we offer:\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0;padding:0;">\n                        <table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="image" data-mobile-width="0" style="max-width: 524px;">\n                            <tbody><tr>\n                                <td valign="top" align="center" style="margin: 0px; padding: 0px; display: inline-block;" class="tdBlock"><img src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_03.png" alt="" width="524" height="397" border="0" data-origsrc="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_03.png" data-src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_03.png|524|397|524|397|0|0|1" style="border: 0px none transparent; display: block;"></td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0; padding:0;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-1" style="margin: 0px; padding: 0px 0px 8px; font-size: 16px; font-family: \'Times New Roman\', Times, serif; line-height: 1.15;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#000000;font-size:24px;">\n                                        Spacious living room\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0;padding:0;">\n                        <table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="image" data-mobile-width="0" style="max-width: 523px;">\n                            <tbody><tr>\n                                <td valign="top" align="center" style="margin: 0px; padding: 0px; display: inline-block;" class="tdBlock"><img src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_04.png" alt="" width="523" height="396" border="0" data-origsrc="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_04.png" data-src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_04.png|523|396|523|396|0|0|1" style="border: 0px none transparent; display: block;"></td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0; padding:0;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-1" style="margin: 0px; padding: 0px 0px 8px; font-size: 16px; font-family: \'Times New Roman\', Times, serif; line-height: 1.15;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#000000;font-size:24px;">\n                                        Modern kitchen\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0;padding:0;">\n                        <table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="image" data-mobile-width="0" style="max-width: 523px;">\n                            <tbody><tr>\n                                <td valign="top" align="center" style="margin: 0px; padding: 0px; display: inline-block;" class="tdBlock"><img src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_05.png" alt="" width="523" height="396" border="0" data-origsrc="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_05.png" data-src="http://email.v-t-club.ru/images/common/templates/messages/1054/1/img/1054_05.png|523|396|523|396|0|0|1" style="border: 0px none transparent; display: block;"></td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0; padding:0;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-1" style="margin: 0px; padding: 0px 0px 8px; font-size: 16px; font-family: \'Times New Roman\', Times, serif; line-height: 1.15;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#000000;font-size:24px;">\n                                        Elegant bathroom\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td align="center" valign="top" style="margin:0; padding:0;">\n                        <table width="100%" align="center" border="0" cellpadding="0" cellspacing="0" data-editable="text">\n                            <tbody><tr>\n                                <td align="center" valign="top" class="lh-1" style="margin: 0px; padding: 25px 50px 20px; font-size: 16px; font-family: \'Times New Roman\', Times, serif; line-height: 1.15;">\n                                    <span style="padding:0;font-family:Helvetica,Arial,sans-serif;font-weight:300;color:#000000;font-size:30px;">\n                                        Step into modern living.\n                                    </span>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n                <tr>\n                    <td valign="top" align="center" style="padding:0 0 50px;margin:0;">\n                        <div data-box="button" style="width: 100%; margin-top: 0px; margin-bottom: 0px; text-align: center;"><table border="0" cellpadding="0" cellspacing="0" align="center" data-editable="button" style="margin: 0px auto;">\n                                <tbody><tr>\n                                    <td valign="middle" align="center" class="tdBlock" style="display: inline-block; padding: 15px 28px 14px; margin: 0px; border-top-left-radius: 6px; border-top-right-radius: 6px; border-bottom-right-radius: 6px; border-bottom-left-radius: 6px; background-color: rgb(0, 176, 255);"><a href="" style="font-family:Helvetica,Arial,sans-serif;color:#ffffff;font-size:20px;font-weight:600;text-decoration:none;">\n                                            Book a visit\n                                        </a></td>\n                                </tr>\n                            </tbody></table></div>\n                    </td>\n                </tr>\n            </tbody></table>\n        </td>\n    </tr>\n</tbody></table>'}}
# print(json.dumps(newsletter_create_response))